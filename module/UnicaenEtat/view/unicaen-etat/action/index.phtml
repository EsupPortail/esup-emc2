<?php

/**
 * @see \UnicaenEtat\Controller\ActionController::indexAction()
 * @var Action[] $actions
 */

use UnicaenEtat\Entity\Db\Action;

/* DOC POUR PLUS TARD
$variable = $actions[0];
$methode = 'setType';
$params   = [ $actions[0]->getType()];

$variable->{$methode}($params[0]);
*/

?>
<h1 class="page-header">
    Index des actions
</h1>

<div class="main">

    <div class="row">
        <div class="col-md-8">
            <h2>Action <span class="badge"><?php echo count($actions); ?></span></h2>
        </div>
        <div class="pull-right">
            <?php /** @see \UnicaenEtat\Controller\IndexController::indexAction() */ ?>
            <a href="<?php echo $this->url('unicaen-etat', [], [], true); ?>"
               class="btn btn-info action">
                <span class="icon retour"></span>
                Retour à l'index du module
            </a>
            <br/>
            <?php /** @see \UnicaenEtat\Controller\ActionController::ajouterAction() */ ?>
            <a href="<?php echo $this->url('unicaen-etat/action/ajouter', [], [], true); ?>"
               class="btn btn-primary action ajax-modal" data-event="modification">
                <span class="icon ajouter"></span>
                Ajouter un état
            </a>
        </div>
    </div>

    <br/>

    <table id="etats" class="datatable table table-condensed">
        <thead>
        <tr>
            <th>Badge</th>
            <th>Code</th>
            <th>Libelle</th>
            <th>Type</th>
            <th style="width: 8rem;">Action</th>
        </tr>
        </thead>
        <tbody>
        <?php foreach ($actions as $action) : ?>
            <tr class="<?php if ($action->estHistorise()) echo "historise"; ?>">
                <td> <?php echo $this->actionbadge($action); ?>  </td>
                <td> <?php echo $action->getCode(); ?> </td>
                <td> <?php echo $action->getLibelle(); ?> </td>
                <td> <?php echo $this->etattype($action->getType()); ?>  </td>
                <td>
                    <?php /** @see \UnicaenEtat\Controller\ActionController::modifierAction() */ ?>
                    <a href="<?php echo $this->url('unicaen-etat/action/modifier', ['action' => $action->getId()], [], true); ?>"
                       class="ajax-modal" data-event="modification">
                        <span class="icon editer"></span></a>
                    <?php if ($action->estNonHistorise()) : ?>
                        <?php /** @see \UnicaenEtat\Controller\ActionController::historiserAction() */ ?>
                        <a href="<?php echo $this->url('unicaen-etat/action/historiser', ['action' => $action->getId()], [], true); ?>">
                            <span class="icon historiser"></span></a>
                    <?php else: ?>
                        <?php /** @see \UnicaenEtat\Controller\ActionController::restaurerAction() */ ?>
                        <a href="<?php echo $this->url('unicaen-etat/action/restaurer', ['action' => $action->getId()], [], true); ?>">
                            <span class="icon restaurer"></span></a>
                    <?php endif; ?>
                    <?php /** @see \UnicaenEtat\Controller\ActionController::supprimerAction() */ ?>
                    <a href="<?php echo $this->url('unicaen-etat/action/supprimer', ['action' => $action->getId()], [], true); ?>"
                       class="ajax-modal" data-event="modification">
                        <span class="icon detruire"></span></a>
                </td>
            </tr>
        <?php endforeach; ?>
        </tbody>
    </table>
</div>

<script>
    $(function() {
        $("body").on("modification", function (event) {
            event.div.modal('hide');
            window.location.reload();
        });
    });
</script>