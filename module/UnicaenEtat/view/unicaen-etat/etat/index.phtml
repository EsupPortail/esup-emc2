<?php

/**
 * @see \UnicaenEtat\Controller\EtatController::indexAction()
 * @var Etat[] $etats
 */

use UnicaenEtat\Entity\Db\Etat;

?>
<h1 class="page-header">
    Index des états
</h1>

<div class="main">

    <div class="row">
        <div class="col-md-8">
            <h2>Etat <span class="badge"><?php echo count($etats); ?></span></h2>
        </div>
        <div class="pull-right">
            <?php /** @see \UnicaenEtat\Controller\IndexController::indexAction() */ ?>
            <a href="<?php echo $this->url('unicaen-etat', [], [], true); ?>"
               class="btn btn-info action">
                <span class="icon icon-retour"></span>
                Retour à l'index du module
            </a>
            <br/>
            <?php /** @see \UnicaenEtat\Controller\EtatController::ajouterAction() */ ?>
            <a href="<?php echo $this->url('unicaen-etat/etat/ajouter', [], [], true); ?>"
               class="btn btn-primary action ajax-modal" data-event="modification">
                <span class="icon icon-ajouter"></span>
                Ajouter un état
            </a>
        </div>
    </div>

    <br/>

    <table id="etat" class="datatable table table-condensed">
        <thead>
        <tr>
            <th>Badge</th>
            <th>Code</th>
            <th>Libelle</th>
            <th>Type</th>
            <th style="width: 8rem;">Action</th>
        </tr>
        </thead>
        <tbody>
        <?php foreach ($etats as $etat) : ?>
            <tr class="<?php if ($etat->estHistorise()) echo "historise"; ?>">
                <td> <?php echo $this->etatbadge($etat); ?>  </td>
                <td> <?php echo $etat->getCode(); ?> </td>
                <td> <?php echo $etat->getLibelle(); ?> </td>
                <td> <?php echo $this->etattype($etat->getType()); ?>  </td>
                <td>
                    <?php /** @see \UnicaenEtat\Controller\EtatController::modifierAction() */ ?>
                    <a href="<?php echo $this->url('unicaen-etat/etat/modifier', ['etat' => $etat->getId()], [], true); ?>"
                       class="ajax-modal" data-event="modification">
                        <span class="icon icon-editer"></span></a>
                    <?php if ($etat->estNonHistorise()) : ?>
                        <?php /** @see \UnicaenEtat\Controller\EtatController::historiserAction() */ ?>
                        <a href="<?php echo $this->url('unicaen-etat/etat/historiser', ['etat' => $etat->getId()], [], true); ?>">
                            <span class="icon icon-historiser"></span></a>
                    <?php else: ?>
                        <?php /** @see \UnicaenEtat\Controller\EtatController::restaurerAction() */ ?>
                        <a href="<?php echo $this->url('unicaen-etat/etat/restaurer', ['etat' => $etat->getId()], [], true); ?>">
                            <span class="icon icon-restaurer"></span></a>
                    <?php endif; ?>
                    <?php /** @see \UnicaenEtat\Controller\EtatController::supprimerAction() */ ?>
                    <a href="<?php echo $this->url('unicaen-etat/etat/supprimer', ['etat' => $etat->getId()], [], true); ?>"
                       class="ajax-modal" data-event="modification">
                        <span class="icon icon-retirer"></span></a>
                </td>
            </tr>
        <?php endforeach; ?>
        </tbody>
    </table>
</div>

<script>
    $(function() {
        $("body").on("modification", function (event) {
            event.div.modal('hide');
            window.location.reload();
        });
    });
</script>