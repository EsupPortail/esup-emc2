<?php

/**
 * @see \Application\Controller\ActiviteController::modifierAction()
 * @var Activite $activite
 */

use Application\Entity\Db\Activite;

$NB_MIN = 30;
?>

<form
        action="<?php echo $this->url('activite/modifier', ['activite' => $activite->getId()], [] , true); ?>"
        method="post">

    <div id="descriptions">
    <?php $position = 1; ?>
    <?php foreach ($activite->getDescriptions() as $description) : ?>
        <div>
            <input id="reference_<?php echo $position; ?>"  name="reference_<?php echo $position; ?>"  type="hidden" value="<?php echo $description->getId(); ?>" />
            <textarea class="description" id="description_<?php echo $position; ?>" name="description_<?php echo $position; ?>"><?php echo trim($description->getDescription()); ?></textarea>
            <input type="button" class="remove btn btn-danger action" value="Retirer"/>
        </div>
        <?php $position++; ?>
    <?php endforeach; ?>
    <?php for ($position_bis = $position; $position_bis <= $NB_MIN ; $position_bis++) : ?>
        <div>
            <input id="reference_<?php echo $position_bis; ?>"  name="reference_<?php echo $position_bis; ?>"  type="hidden" value=""/>
            <textarea class="description" id="description_<?php echo $position_bis; ?>" name="description_<?php echo $position_bis; ?>"></textarea>
            <input type="button" class="remove btn btn-danger action" value="Retirer"/>
        </div>
    <?php endfor; ?>
    </div>
    <input id="count" name="count" type="hidden" value="<?php echo $position; ?>"/>
    <input type="button" class="add btn btn-success action" value="Ajouter"/>
    <input id="submit" class="btn btn-primary action" value="Enregistrer"/>
</form>


<script>
    $(function() {
       for (let i = <?php echo $position; ?> ; i < 50 ; i++) $('input#reference_' + i).parent().hide();
    });
    $('input.add').click(function () {
        let position = $('input#count').val();
        $('input#reference_' + position).parent().show();
        // alert(position);
        //$('div#descriptions').append("<div>\n" +
        //    "            <input id=\"reference_<?php //echo $position; ?>//\"  name=\"reference_<?php //echo $position; ?>//\"  type=\"hidden\" value=\"\" />\n" +
        //    "            <textarea class=\"description\" id=\"description_<?php //echo $position; ?>//\" name=\"description_<?php //echo $position; ?>//\"></textarea>\n" +
        //    "            <input type=\"button\" class=\"remove btn btn-danger action\" value=\"Retirer\"/>\n" +
        //    "        </div>");
        $('input#count').val( parseInt(position) + 1);
    });
    $('input.remove').click(function () {
        $(this).parent().remove();
    })

    $('select').selectpicker();

    $(document).ready(function() {
        tinymce.remove();
        tinymce.init({
            selector: '.description',
            toolbar: 'newdocument undo redo | bold italic',
            resize: true,
            language: 'fr_FR',
            plugins: 'lists',
            statusbar: true,
            browser_spellcheck: true,
            branding: false,
            menu: {},
            body_id: 'motif',
            setup: function (editor) {
                editor.on("focusout", function () {
                    let id = $(this).attr('id');
                    $('textarea#' + id).val(tinymce.get(id).getContent());
                });
            }
        });
    });
</script>
