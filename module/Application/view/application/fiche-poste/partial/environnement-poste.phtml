<?php

use Application\Entity\Db\Agent;
use Application\Entity\Db\FichePoste;
use Application\Entity\Db\Structure;
use Application\Provider\Privilege\FichePostePrivileges;

/**
 * @var FichePoste $fiche
 * @var Agent $agent
 * @var Structure|null $structure
 * @var string mode
 */

$canModifier = $this->isAllowed($fiche, FichePostePrivileges::FICHEPOSTE_MODIFIER);

$poste = $fiche->getPoste();
?>

<div class="panel panel-info">
    <div class="panel-heading">
        <div class="row">
            <div class="col-md-6">
                <h2> Environnement du poste de travail </h2>
            </div>
            <div class="col-md-6">
<!--                --><?php //if($mode === 'edition' AND $canModifier) : ?>
<!--                    --><?php ///** @see \Application\Controller\FichePosteController::associerPosteAction() */ ?>
<!--                    <a href="--><?php //echo $this->url('fiche-poste/associer-poste',['fiche-poste' => $fiche->getId()], ["query" => ["structure" => ($structure)?$structure->getId():null, "sous-structure" => $sousstructure]], true); ?><!--"-->
<!--                       class="btn btn-primary action ajax-modal pull-right"-->
<!--                       data-event="modification"-->
<!--                    >-->
<!--                        <span class="icon selectionner"></span>-->
<!--                        Associer un poste-->
<!--                    </a>-->
<!--                --><?php //endif; ?>
            </div>
        </div>
    </div>
    <div class="panel-body">
        <?php
            $structures = [];
            if ($agent !== null) $structures = $agent->getStructures();
            else if ($structure !== null) $structures[] = $structure;
        ?>
        <?php if (empty($structures)) : ?>
            <div class="alert alert-warning">
                <i class="fas fa-exclamation-triangle"></i>
                Aucune structure.
            </div>
        <?php else: ?>
            <?php foreach ($structures as $structure) : ?>
                <h4> <?php echo $structure->getLibelleLong(); ?> </h4>

                <?php if ($structure->getDescription() !== null) :?>
                    <?php echo $structure->getDescription(); ?>
                <?php else: ?>
                    <div class="alert alert-warning">
                        <i class="fas fa-exclamation-triangle"></i>
                        Aucune description de fournie pour l'affectation <em><?php echo $structure->getLibelleCourt(); ?></em>.
                    </div>
                <?php endif; ?>
            <?php endforeach; ?>
        <?php endif; ?>

        <!--        <h3> Positionnement dans l'établissement</h3>-->
<!--        --><?php //if ($poste === null) : ?>
<!--            <div class="alert alert-warning">-->
<!--                <i class="fas fa-exclamation-triangle"></i>-->
<!--                Aucun poste n'est attaché à ce poste-->
<!--            </div>-->
<!--        --><?php //else: ?>
<!--            --><?php //echo $this->poste($poste); ?>
<!--        --><?php //endif; ?>
    </div>
</div>