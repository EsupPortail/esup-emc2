<?php

use Application\Controller\FichePosteController;
use Application\Entity\Db\FichePoste;
use Application\Provider\Privilege\FichePostePrivileges;

/**
 * @var FichePoste[] $fiches
 * @var FichePoste[] $fichesSansAgent
 * @var FichePoste[] $fichesSansPoste
 * @var FichePoste[] $fichesProblemes
 * @var FichePoste[] $fichesOks
 */

$this->headTitle('Index des fiches de postes');

$canAjouter     = $this->isAllowed(FichePostePrivileges::getResourceId(FichePostePrivileges::AJOUTER));
$canVoir        = $this->isAllowed(FichePostePrivileges::getResourceId(FichePostePrivileges::AFFICHER));
$canHistoriser  = $this->isAllowed(FichePostePrivileges::getResourceId(FichePostePrivileges::HISTORISER));
$canEditer      = $this->isAllowed(FichePostePrivileges::getResourceId(FichePostePrivileges::EDITER));
$canDetruire    = $this->isAllowed(FichePostePrivileges::getResourceId(FichePostePrivileges::EDITER));

?>

<h1 class="page-header">
    Fiches de poste
    <span class="badge">
        <?php echo count($fiches); ?>
    </span>
</h1>

<?php if ($canAjouter) : ?>
    <?php /** @see FichePosteController::ajouterAction() */ ?>
    <a href="<?php echo $this->url('fiche-poste/ajouter', [], [], true); ?>" class="btn btn-primary ajax-modal" data-event="modification">
        <span class="icon ajouter"></span>
        Ajouter une fiche de poste
    </a>
<?php endif; ?>

<div class="main">
    <h2>
        Fiches sans agent
        <span class="badge">
            <?php echo count($fichesSansAgent); ?>
        </span>
    </h2>

    <?php echo $this->fichesPostesAsArray($fichesSansAgent); ?>
</div>

<div class="main">
    <h2>
        Fiches sans poste
        <span class="badge">
            <?php echo count($fichesSansPoste); ?>
        </span>
    </h2>

    <?php echo $this->fichesPostesAsArray($fichesSansPoste); ?>
</div>

<div class="main">
    <h2>
        Fiches probl√®matiques
        <span class="badge">
            <?php echo count($fichesProblemes); ?>
        </span>
    </h2>

    <?php echo $this->fichesPostesAsArray($fichesProblemes); ?>
</div>

<div class="main">
    <h2>
        Fiches avec agent et postes
        <span class="badge">
            <?php echo count($fichesOks); ?>
        </span>
    </h2>

    <?php echo $this->fichesPostesAsArray($fichesOks); ?>
</div>



<script>
    $(function() {
        $("body").on("modification", function (event) {
            event.div.modal('hide');
            window.location.reload();
        });
    });

    $(function() {
        $("body").on("edition", function (event) {
            event.div.modal('hide');
            window.location.href = 'fiche-poste/editer';
        });
    });

    $(document).ready(function() {
        $('.datatable').DataTable( {
            language: {
                url: '/localisation/fr_FR.json'
            }
        });
    });
</script>
