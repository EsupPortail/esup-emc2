<?php

/**
 * @var Agent $agent
 * @var ParcoursDeFormation $parcours
 */

use Application\Entity\Db\Agent;
use Application\Entity\Db\ParcoursDeFormation;

$canVoir = true;
$canAjouter = true;
$canModifier = true;
$canHistoriser = true;
$canDetruire = true;
$canValider = true;
?>

<h2> Entrée dans le métier </h2>

<dl class="dl-horizontal">
    <dt>
        Catégorie de l'agent
    </dt>
    <dd>
        <?php $grades = $agent->getGradesActifs(); ?>
        <?php foreach ($grades as $grade) : ?>
            <?php echo '&nbsp;'. $grade->getCorps()->getCategorie(); ?>
        <?php endforeach; ?>
    </dd>
</dl>

Quid que faire quand un agent est position sur plusieurs grades (affection) ? LE PLUS ELEVE ?

<?php echo  $parcours->getLibelle(); ?>

<table>
    <?php foreach ($parcours->getFormations() as $formation) :  ?>
        <tr><td>
            <?php echo $formation->getLibelle(); ?>
        </td></tr>
    <?php endforeach; ?>
</table>

<h2> Acquis de l'agent </h2>

<div class="blocs">
    <div class="bloc">
        <h3>
            <span class="icon application"></span>
            Applications
            <?php if ($canAjouter) : ?>
                <a
                    <?php /** @see \Application\Controller\AgentController::ajouterAgentApplicationAction() */?>
                    href="<?php echo $this->url('agent/ajouter-agent-application', ['agent' => $agent->getId()], [], true); ?>"
                    class="ajax-modal"
                    data-event="modification"
                >
                    <span class="icon ajouter" title="Ajouter une application maîtriser par l'agent"></span>
                </a>
            <?php endif; ?>
        </h3>
        <ul>
            <?php foreach ($agent->getApplications() as $application) : ?>
                <li>
                    <?php echo $application->getApplication()->getLibelle(); ?>
                    <br/>
                    <?php echo $application->getType(); ?>
                    <?php if ($application->getAnnee()) : ?>
                        (<?php echo $application->getAnnee(); ?>)
                    <?php endif; ?>
                    - &nbsp;
                    <?php if ($application->getValidation()) : ?>
                    <?php $validation = $application->getValidation(); ?>
                    <?php if ($validation->getValeur() === null) : ?>
                        <span
                            style="color:darkgreen;"
                            title=" Par <?php echo $validation->getHistoModificateur()->getDisplayName(); ?> le <?php echo $validation->getHistoModification()->format("d/m/Y"); ?>">
                                <span class="icon ok"></span>
                                Validée
                            </span>
                    <?php else: ?>
                    <span
                        style="color:darkred;"
                        title=" Par <?php echo $validation->getHistoModificateur()->getDisplayName(); ?> le <?php echo $validation->getHistoModification()->format("d/m/Y"); ?>">
                                <span class="icon ko"></span>
                            Refusée
                        <?php endif; ?>
                        <?php else : ?>
                            Aucune validation
                        <?php endif; ?>
                    <br/>
                    <?php if ($canVoir) : ?>
                        <a
                            <?php /** @see \Application\Controller\AgentController::afficherAgentApplicationAction() */?>
                                href="<?php echo $this->url('agent/afficher-agent-application', ['agent-application' => $application->getId()], [], true); ?>"
                                class="ajax-modal"
                        >
                            <span class="icon voir" title="Afficher une application maîtriser par l'agent"></span></a>
                    <?php endif; ?>
                        <?php if ($canModifier) : ?>
                            <a
                            <?php /** @see \Application\Controller\AgentController::modifierAgentApplicationAction() */?>
                                href="<?php echo $this->url('agent/modifier-agent-application', ['agent-application' => $application->getId()], [], true); ?>"
                                class="ajax-modal"
                                data-event="modification"
                            >
                            <span class="icon editer" title="Modifier une application maîtriser par l'agent"></span></a>
                        <?php endif; ?>
                        <?php if ($canHistoriser) : ?>
                            <?php if ($application->estNonHistorise()) : ?>
                                <a
                                <?php /** @see \Application\Controller\AgentController::historiserAgentApplicationAction() */?>
                                    href="<?php echo $this->url('agent/historiser-agent-application', ['agent-application' => $application->getId()], [], true); ?>"
                                >
                                <span class="icon historiser" title="Historiser une application maîtriser par l'agent"></span></a>
                            <?php else: ?>
                                <a
                                <?php /** @see \Application\Controller\AgentController::restaurerAgentApplicationAction() */?>
                                    href="<?php echo $this->url('agent/restaurer-agent-application', ['agent-application' => $application->getId()], [], true); ?>"
                                >
                                <span class="icon restaurer" title="Restaurer une application maîtriser par l'agent"></span></a>
                            <?php endif; ?>
                        <?php endif; ?>
                        <?php if ($canDetruire) : ?>
                            <a
                            <?php /** @see \Application\Controller\AgentController::detruireAgentApplicationAction() */?>
                                href="<?php echo $this->url('agent/detruire-agent-application', ['agent-application' => $application->getId()], [], true); ?>"
                                class="ajax-modal"
                                data-event="modification"
                            >
                            <span class="icon detruire" title="Supprimer définitivement une application maîtriser par l'agent"></span>
                        </a>
                        <?php endif; ?>
                        <?php if ($canValider) : ?>
                            <?php if ($application->getValidation() === null) : ?>
                                <a
                                <?php /** @see \Application\Controller\AgentController::validerElementAction() */ ?>
                                href="<?php echo $this->url('agent/valider-element', ['type' => "AgentApplication", 'id' => $application->getId()], [], true); ?>"
                                class="ajax-modal"
                                data-event="modification"
                                >
                                <span class="icon validation-do" title="Valider l'application"></span></a>
                            <?php else: ?>
                                <a
                                <?php /** @see \Application\Controller\AgentController::revoquerElementAction() */ ?>
                                    href="<?php echo $this->url('agent/revoquer-element', ['validation' => $application->getValidation()->getId()], [], true); ?>"
                                >
                                <span class="icon validation-undo" title="Dévalider l'application"></span></a>
                            <?php endif; ?>
                        <?php endif; ?>
                </li>
            <?php endforeach; ?>
        </ul>
    </div>
    <div class="bloc">
        <h3>
            <span class="icon competence"></span>
            Compétences
            <?php if ($canAjouter) : ?>
                <a
                    <?php /** @see \Application\Controller\AgentController::ajouterAgentCompetenceAction() */?>
                    href="<?php echo $this->url('agent/ajouter-agent-competence', ['agent' => $agent->getId()], [], true); ?>"
                    class="ajax-modal"
                    data-event="modification"
                >
                    <span class="icon ajouter" title="Ajouter une compétence liée à l'agent"></span>
                </a>
            <?php endif; ?>
        </h3>

        <ul>
            <?php foreach ($agent->getCompetences() as $competence) : ?>
                <li>
                    <?php echo $competence->getCompetence()->getLibelle(); ?>
                    <br/>
                    <?php echo $competence->getNiveau(); ?>
                    - &nbsp;
                    <?php if ($competence->getValidation()) : ?>
                    <?php $validation = $competence->getValidation(); ?>
                    <?php if ($validation->getValeur() === null) : ?>
                        <span
                            style="color:darkgreen;"
                            title=" Par <?php echo $validation->getHistoModificateur()->getDisplayName(); ?> le <?php echo $validation->getHistoModification()->format("d/m/Y"); ?>">
                                <span class="icon ok"></span>
                                Validée
                            </span>
                    <?php else: ?>
                    <span
                        style="color:darkred;"
                        title=" Par <?php echo $validation->getHistoModificateur()->getDisplayName(); ?> le <?php echo $validation->getHistoModification()->format("d/m/Y"); ?>">
                                <span class="icon ko"></span>
                            Refusée
                        <?php endif; ?>
                        <?php else : ?>
                            Aucune validation
                        <?php endif; ?>
                    <br/>
                        <?php if ($canVoir) : ?>
                            <a
                                <?php /** @see \Application\Controller\AgentController::afficherAgentCompetenceAction() */?>
                                    href="<?php echo $this->url('agent/afficher-agent-competence', ['agent-competence' => $competence->getId()], [], true); ?>"
                                    class="ajax-modal"
                            >
                                <span class="icon voir" title="Afficher une compétence liée à l'agent"></span></a>
                        <?php endif; ?>
                        <?php if ($canModifier) : ?>
                            <a
                                <?php /** @see \Application\Controller\AgentController::modifierAgentCompetenceAction() */?>
                                    href="<?php echo $this->url('agent/modifier-agent-competence', ['agent-competence' => $competence->getId()], [], true); ?>"
                                    class="ajax-modal"
                                    data-event="modification"
                            >
                                <span class="icon editer" title="Modifier une compétence liée à l'agent"></span></a>
                        <?php endif; ?>
                        <?php if ($canHistoriser) : ?>
                            <?php if ($application->estNonHistorise()) : ?>
                                <a
                                    <?php /** @see \Application\Controller\AgentController::historiserAgentCompetenceAction() */?>
                                        href="<?php echo $this->url('agent/historiser-agent-competence', ['agent-competence' => $competence->getId()], [], true); ?>"
                                >
                                    <span class="icon historiser" title="Historiser une compétence liée à l'agent"></span></a>
                            <?php else: ?>
                                <a
                                    <?php /** @see \Application\Controller\AgentController::restaurerAgentCompetenceAction() */?>
                                        href="<?php echo $this->url('agent/restaurer-agent-competence', ['agent-competence' => $competence->getId()], [], true); ?>"
                                >
                                    <span class="icon restaurer" title="Restaurer une compétence liée à l'agent"></span></a>
                            <?php endif; ?>
                        <?php endif; ?>
                        <?php if ($canDetruire) : ?>
                            <a
                                <?php /** @see \Application\Controller\AgentController::detruireAgentCompetenceAction() */?>
                                    href="<?php echo $this->url('agent/detruire-agent-competence', ['agent-competence' => $competence->getId()], [], true); ?>"
                                    class="ajax-modal"
                                    data-event="modification"
                            >
                                <span class="icon detruire" title="Supprimer définitivement une compétence liée à l'agent"></span>
                            </a>
                        <?php endif; ?>
                        <?php if ($canValider) : ?>
                            <?php if ($competence->getValidation() === null) : ?>
                                <a
                                <?php /** @see \Application\Controller\AgentController::validerElementAction() */ ?>
                                href="<?php echo $this->url('agent/valider-element', ['type' => "AgentCompetence", 'id' => $competence->getId()], [], true); ?>"
                                class="ajax-modal"
                                data-event="modification"
                                >
                                <span class="icon validation-do" title="Valider la compétence"></span></a>
                            <?php else: ?>
                                <a
                                <?php /** @see \Application\Controller\AgentController::revoquerElementAction() */ ?>
                                    href="<?php echo $this->url('agent/revoquer-element', ['validation' => $competence->getValidation()->getId()], [], true); ?>"
                                >
                                <span class="icon validation-undo" title="Dévalider la compétence"></span></a>
                            <?php endif; ?>
                        <?php endif; ?>
                </li>
            <?php endforeach; ?>
        </ul>
    </div>
    <div class="bloc">
        <h3>
            <span class="icon formation"></span>
            Formations
            <?php if ($canAjouter) : ?>
                <a
                    <?php /** @see \Application\Controller\AgentController::ajouterAgentFormationAction() */?>
                    href="<?php echo $this->url('agent/ajouter-agent-formation', ['agent' => $agent->getId()], [], true); ?>"
                    class="ajax-modal"
                    data-event="modification"
                >
                    <span class="icon ajouter" title="Ajouter une formation liée à l'agent"></span>
                </a>
            <?php endif; ?>
        </h3>

        <ul>
            <?php foreach ($agent->getFormations() as $formation) : ?>
                <li>
                    <?php echo $formation->getFormation()->getLibelle(); ?> <br/>
                    <?php echo $formation->getDate()->format('d/m/Y'); ?>
                    - &nbsp;
                    <?php if ($formation->getValidation()) : ?>
                    <?php $validation = $formation->getValidation(); ?>
                    <?php if ($validation->getValeur() === null) : ?>
                        <span
                            style="color:darkgreen;"
                            title=" Par <?php echo $validation->getHistoModificateur()->getDisplayName(); ?> le <?php echo $validation->getHistoModification()->format("d/m/Y"); ?>">
                                <span class="icon ok"></span>
                                Validée
                            </span>
                    <?php else: ?>
                    <span
                        style="color:darkred;"
                        title=" Par <?php echo $validation->getHistoModificateur()->getDisplayName(); ?> le <?php echo $validation->getHistoModification()->format("d/m/Y"); ?>">
                                <span class="icon ko"></span>
                            Refusée
                        <?php endif; ?>
                        <?php else : ?>
                            Aucune validation
                        <?php endif; ?>
                    <br/>
                        <?php if ($canVoir) : ?>
                            <a
                            <?php /** @see \Application\Controller\AgentController::afficherAgentFormationAction() */?>
                                href="<?php echo $this->url('agent/afficher-agent-formation', ['agent-formation' => $formation->getId()], [], true); ?>"
                                class="ajax-modal"
                            >
                            <span class="icon voir" title="Afficher une formation liée à l'agent"></span></a>
                        <?php endif; ?>
                        <?php if ($canModifier) : ?>
                            <a
                                <?php /** @see \Application\Controller\AgentController::modifierAgentFormationAction() */?>
                                    href="<?php echo $this->url('agent/modifier-agent-formation', ['agent-formation' => $formation->getId()], [], true); ?>"
                                    class="ajax-modal"
                                    data-event="modification"
                            >
                                <span class="icon editer" title="Modifier une formation liée à l'agent"></span></a>
                        <?php endif; ?>
                        <?php if ($canHistoriser) : ?>
                            <?php if ($application->estNonHistorise()) : ?>
                                <a
                                    <?php /** @see \Application\Controller\AgentController::historiserAgentFormationAction() */?>
                                        href="<?php echo $this->url('agent/historiser-agent-formation', ['agent-formation' => $formation->getId()], [], true); ?>"
                                >
                                    <span class="icon historiser" title="Historiser une formation liée à l'agent"></span></a>
                            <?php else: ?>
                                <a
                                    <?php /** @see \Application\Controller\AgentController::restaurerAgentFormationAction() */?>
                                        href="<?php echo $this->url('agent/restaurer-agent-formation', ['agent-formation' => $formation->getId()], [], true); ?>"
                                >
                                    <span class="icon restaurer" title="Restaurer une formation liée à l'agent"></span></a>
                            <?php endif; ?>
                        <?php endif; ?>
                        <?php if ($canDetruire) : ?>
                            <a
                                <?php /** @see \Application\Controller\AgentController::detruireAgentFormationAction() */?>
                                    href="<?php echo $this->url('agent/detruire-agent-formation', ['agent-formation' => $formation->getId()], [], true); ?>"
                                    class="ajax-modal"
                                    data-event="modification"
                            >
                                <span class="icon detruire" title="Supprimer définitivement une formation liée à l'agent"></span>
                            </a>
                        <?php endif; ?>
                        <?php if ($canValider) : ?>
                            <?php if ($formation->getValidation() === null) : ?>
                                <a
                            <?php /** @see \Application\Controller\AgentController::validerElementAction() */ ?>
                            href="<?php echo $this->url('agent/valider-element', ['type' => "AgentFormation", 'id' => $formation->getId()], [], true); ?>"
                            class="ajax-modal"
                            data-event="modification"
                                >
                            <span class="icon validation-do" title="Valider la formation"></span></a>
                            <?php else: ?>
                                <a
                            <?php /** @see \Application\Controller\AgentController::revoquerElementAction() */ ?>
                                href="<?php echo $this->url('agent/revoquer-element', ['validation' => $formation->getValidation()->getId()], [], true); ?>"
                                >
                            <span class="icon validation-undo" title="Dévalider la formation"></span></a>
                            <?php endif; ?>
                        <?php endif; ?>
                </li>
            <?php endforeach; ?>
        </ul>
    </div>
</div>


<style>
    div.bloc {
        border: solid lightblue 1px;
        margin: 0.5rem;
        padding: 0.5rem;
        width: 32%;
        min-width: 200px;
        float: left;
    }

    .blocs {
        display: flex;
        flex-wrap: wrap;
    }
</style>
