<?php

/**
 * @see \Application\Controller\IndexController::indexSuperieurAction()
 * @var Agent $connectedAgent
 * @var Agent[] $agents

 *
 * @var FichePoste[] $fiches
 * @var EntretienProfessionnel[] $entretiens
 * @var FormationInstanceInscrit[] $demandesInternes
 * @var DemandeExterne[] $demandesExternes
 */
use Application\Entity\Db\Agent;
use Application\Entity\Db\FichePoste;
use Application\Provider\Privilege\AgentPrivileges;
use Application\Provider\Privilege\FichePostePrivileges;
use EntretienProfessionnel\Entity\Db\Campagne;
use EntretienProfessionnel\Entity\Db\EntretienProfessionnel;
use Formation\Entity\Db\DemandeExterne;
use Formation\Entity\Db\FormationInstanceInscrit;

$canVoirAgent = $this->isAllowed(AgentPrivileges::getResourceId(AgentPrivileges::AGENT_AFFICHER));
?>

<h1 class="card-header">
    Liste des agents dont vous êtes le supérieur hiérarchique direct
</h1>

<div class="alert alert-info">
    <span class="icon icon-attention"></span>
    Ici ne figurent que les agents pour lesquels vous avez été désigné manuellement en tant que supérieur&middot;e hiérarchique direct&middot;e
</div>

<?php echo $this->messenger()->addMessagesFromFlashMessenger(); ?>


<ul class="nav">
<!--    <li class="nav-item">-->
<!--        <a class="nav-link" href="#ficheposte" aria-controls="ficheposte" role="tab"   data-toggle="tabz">-->
<!--            Fiches de poste-->
<!--        </a>-->
<!--    </li>-->
    <li class="nav-item" >
        <a class="nav-link" href="#entretien" aria-controls="entretien" role="tab"   data-toggle="tabz">
            Entretiens professionnel
        </a>
    </li>
    <li class="nav-item" >
        <a class="nav-link" href="#formation" aria-controls="formation" role="tab"  data-toggle="tabz">
            Formations
        </a>
    </li>
</ul>


<div class="tab-content">
    <div id="ficheposte" class="tab-pane " role="tabpanel">
        <?php echo $this->partial('partial/ficheposte', ['agents' => $agents, 'fiches' => $fiches], [], true); ?>
    </div>
    <div id="entretien" class="tab-pane " role="tabpanel">
        <?php echo $this->partial('partial/entretien', ['agents' => $agents, 'campagnePrevious' => $campagnePrevious, 'campagnesCurrents' => $campagnesCurrents], [], true); ?>
    </div>
    <div id="formation" class="tab-pane " role="tabpanel">
        <?php echo $this->partial('partial/formation', ['agents' => $agents, 'demandesInternes' => $demandesInternes, 'demandesExternes' => $demandesExternes], [], true); ?>
    </div>
</div>


<script>
    $(function() {
        let hash = $(location).attr('hash');
        let name = hash.substr(1);
        if (name === undefined || name === "") name = "entretien";

        $('a[aria-controls=' + name + ']').tab('show');

        $('.nav-item a').click(function (e) {
            // No e.preventDefault() here
            $(this).tab('show');
        });
    });

    $(function() {
        $("body").on("modification", function (event) {
            event.div.modal('hide');
            window.location.reload();
        });
    });
</script>

