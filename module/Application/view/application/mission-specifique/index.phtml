<?php

use Application\Entity\Db\MissionSpecifique;
use Application\Entity\Db\MissionSpecifiqueTheme;
use Application\Entity\Db\MissionSpecifiqueType;
use Application\Provider\Privilege\MissionspecifiquePrivileges;

/**
 * @see \Application\Controller\MissionSpecifiqueController::indexAction()
 * @var MissionSpecifique[] $missions
 * @var MissionSpecifiqueType[] $types
 * @var MissionSpecifiqueTheme[] $themes
 * @var array $params
 */

$canVoir            = $this->isAllowed(MissionspecifiquePrivileges::getResourceId(MissionspecifiquePrivileges::MISSIONSPECIFIQUE_GESTION_AFFICHER));
$canAjouter         = $this->isAllowed(MissionspecifiquePrivileges::getResourceId(MissionspecifiquePrivileges::MISSIONSPECIFIQUE_GESTION_AJOUTER));
$canModifier        = $this->isAllowed(MissionspecifiquePrivileges::getResourceId(MissionspecifiquePrivileges::MISSIONSPECIFIQUE_GESTION_MODIFIER));
$canHistoriser      = $this->isAllowed(MissionspecifiquePrivileges::getResourceId(MissionspecifiquePrivileges::MISSIONSPECIFIQUE_GESTION_HISTORISER));
$canDetruire        = $this->isAllowed(MissionspecifiquePrivileges::getResourceId(MissionspecifiquePrivileges::MISSIONSPECIFIQUE_GESTION_DETRUIRE));

$droits = [
    'voir' => $canVoir,
    'ajouter' => $canAjouter,
    'modifier' => $canModifier,
    'historiser' => $canHistoriser,
    'detruire' => $canDetruire,
];

$this->headTitle("Missions spécifiques");
?>

<h1 class="page-header">
    Missions spécifiques
</h1>

<div class="main">
    <div role="tabpanel">
        <ul class="nav nav-tabs" role="tablist">

            <li role="mission">
                <a href="#mission" aria-controls="mission" role="tab" data-toggle="tabz">
                    Missions spécifiques &nbsp;
                    <span class="badge">
                    <?php echo count($missions); ?>
                </span>
                </a>
            </li>

            <li role="type">
                <a href="#type" aria-controls="type" role="tab" data-toggle="tabz">
                    Types &nbsp;
                    <span class="badge">
                    <?php echo count($types); ?>
                </span>
                </a>
            </li>

            <li role="theme">
                <a href="#theme" aria-controls="theme" role="tab" data-toggle="tabz" >
                    Thèmes &nbsp;
                    <span class="badge">
                    <?php echo count($themes); ?>
                </span>
                </a>
            </li>
        </ul>
    </div>
        <div class="main-with-tab">

            <div class="tab-content">

                <!-- Mission------------------------------------------------------------------------------------------->
                <div id="mission" class="tab-pane " role="tabpanel">
                    <?php echo $this->partial('partial/index-mission', ['missions' => $missions, 'types' => $types, 'themes' => $themes, 'params' => $params, 'droits' => $droits]); ?>
                </div>

                <!-- Type---------------------------------------------------------------------------------------------->
                <div id="type" class="tab-pane " role="tabpanel">
                    <?php echo $this->partial('partial/index-type', ['types' => $types, 'droits' => $droits]); ?>
                </div>

                <!-- Theme--------------------------------------------------------------------------------------------->
                <div id="theme" class="tab-pane " role="tabpanel">
                    <?php echo $this->partial('partial/index-theme', ['themes' => $themes, 'droits' => $droits]); ?>
                </div>

            </div>
        </div>

</div>


<script>
    $(function() {
        $("body").on("modification", function (event) {
            event.div.modal('hide');
            tinyMCE.editors=[];
            window.location.reload();
        });
    });

    $(function() {
        let hash = $(location).attr('hash');
        let name = hash.substr(1);
        if (name === undefined || name === "") name = "mission";

        $('a[aria-controls=' + name + ']').tab('show');

        $('.nav-tabs a').click(function (e) {
            // No e.preventDefault() here
            $(this).tab('show');
        });
    });
</script>