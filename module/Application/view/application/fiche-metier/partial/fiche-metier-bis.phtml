<?php

use Application\Entity\Db\FicheMetier;
use Application\Entity\Db\Metier;

/**
 * @var Metier[] $metiers
 * @var FicheMetier $fiche
 */

?>

<table class="datatable table table-condensed">
    <thead>
    <tr>
        <th> Métier </th>
        <th> Fiche </th>
        <th> État </th>
        <th> Action </th>
    </tr>
    </thead>
    <tbody>
    <?php foreach ($metiers as $metier) : ?>
        <?php
            $fiches = $metier->getFichesMetiers();
            $nbFiche = count($fiches);
        ?>

            <?php if ($nbFiche === 0) : ?>
                <tr><td>
                    <span data-toggle="tooltip" data-html="true" title='<?php echo $metier->generateTooltip(); ?>'>
                        <?php echo $metier->getLibelle(); ?>
                    </span>
                </td><td>
                    Aucune fiche métier
                </td><td></td>
                <td></td>
                </tr>
            <?php else : ?>
                <?php $first = true; ?>
                <?php foreach ($fiches as $fiche) : ?>
                    <tr>
<!--                        --><?php //if ($first) : ?>
<!--                            <td rowspan="--><?php //echo $nbFiche; ?><!--">-->
                        <td>
                                <span data-toggle="tooltip" data-html="true" title='<?php echo $metier->generateTooltip(); ?>'>
                                    <?php echo $metier->getLibelle(); ?>
                                </span>
                            </td>
<!--                            --><?php //$first = false; ?>
<!--                        --><?php //else : ?>
<!--                            <td></td>-->
<!--                        --><?php //endif; ?>
                        <td> #<?php echo $fiche->getId(); ?> (Création <?php echo $fiche->getHistoCreation()->format("d/m/Y à H:m:i"); ?>)</td>
                        <td> <?php echo $this->ficheMetierEtat($fiche->getEtat()); ?></td>
                        <td></td>
                    </tr>
                <?php endforeach; ?>
            <?php endif; ?>
    <?php endforeach; ?>
    </tbody>
</table>