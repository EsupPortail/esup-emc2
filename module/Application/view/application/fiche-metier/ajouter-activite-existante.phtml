<?php

use Application\Entity\Db\FicheMetier;
use UnicaenApp\Form\Element\SearchAndSelect;

/**
 * @see \Application\Controller\FicheMetierController::ajouterActiviteExistanteAction()
 * @var FicheMetier $fichemetier
 */

?>

<form method="post" action="<?php echo $this->url('fiche-metier-type/ajouter-activite-existante', ['id' => $fichemetier->getId()], [], true); ?>">
    <label for="formation">Activité à ajouter : </label>
    <?php
    /** @see  \Application\Controller\ActiviteController::rechercherActiviteAction() */
    $structureF = new SearchAndSelect('activite');
    $structureF
        ->setAutocompleteSource($this->url('activite/rechercher-activite'))
        ->setSelectionRequired(true)
        ->setAttributes([
            'id' => 'activite',
            'placeholder' => "Sélectionner une activité",
        ]);
    ?>
    <?php echo $this->formControlGroup($structureF); ?>
    <input type="submit" value="Ajouter l'activité" class="btn btn-primary action">
</form>

<div id="description">

</div>

<script>
   $(function() {
       $("input[type=text]").change(function (e) {
           let activite_id = $("input#activite").val();

           let url = "../../mission-principale/afficher/" + activite_id;
           $.ajax({
               type: "POST",
               url: url,
               beforeSend:
                   function () {
                       document.getElementById('description').innerHTML = "Récupération de l'activité ...";
                   },
               success:
                   function (retour) {
                       document.getElementById('description').innerHTML = retour;
                   }
           });
       });
   });
</script>
