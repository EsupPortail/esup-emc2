<?php

use Application\Provider\Privilege\FicheMetierPrivileges;
use Metier\Entity\Db\Domaine;
use Application\Entity\Db\FicheMetier;
use Metier\Entity\Db\Metier;
use UnicaenEtat\Entity\Db\Etat;

/**
 * @see \Application\Controller\FicheMetierController::indexAction()
 * @var Domaine[] $domaines
 * @var FicheMetier[] $fiches
 * @var Etat[] $etats
 * @var array $params
 */


$canAjouter     = $this->isAllowed(FicheMetierPrivileges::getResourceId(FicheMetierPrivileges::FICHEMETIER_AJOUTER));

$this->headTitle('Index des fiches métiers');

?>

<div class="row">
    <div class="col-md-8">
        <h1 class="page-header">
            Fiches métiers
        </h1>
    </div>
    <div class="pull-right">
        <?php if ($canAjouter) : ?>
            <br/>
            <?php /** @see \Application\Controller\FicheMetierController::ajouterAction() */ ?>
            <a href="<?php echo $this->url('fiche-metier-type/ajouter', [], [], true); ?>"
               class="btn btn-primary action ajax-modal" data-event="creation">
                <span class="icon icon-ajouter"></span>
                Ajouter une fiche métier
            </a>
        <?php endif; ?>
    </div>
</div>

<?php echo $this->messenger()->addMessagesFromFlashMessenger(); ?>

<div class="main">

    <?php echo $this->partial('partial/filtre.phtml', ['etats' => $etats, 'domaines'=> $domaines, 'params' => $params]); ?>

    <?php echo $this->partial('partial/fiche-metier.phtml', ['fiches' => $fiches, 'domaines' => $domaines]); ?>

</div>


<script>
    $(document).ready(function() {
        $('#datatable').DataTable( {
            language: {
                url: '/localisation/fr_FR.json'
            }
        } );
    } );

    $(function() {
        $("body").on("creation", function (event) {
            event.div.modal('hide');
            window.location.reload();
        });
    });

    $(function() {
        $("body").on("destruction", function (event) {
            event.div.modal('hide');
            window.location.reload();
        });
    });

    $(function() {
        $("body").on("modification", function (event) {
            event.div.modal('hide');
            window.location.reload();
        });
    });

    $(function() {
        $("body").on("changer-etat", function (event) {
            event.div.modal('hide');
            window.location.reload();
        });
    });
</script>