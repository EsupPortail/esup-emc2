<?php

/**
 * @see \Application\Controller\CorpsController::indexAction()
 * @var Categorie[] $categories
 * @var Corps[] $corps
 * @var Grade[] $grades
 * @var Correspondance[] $correspondances
 */

use Application\Entity\Db\Categorie;
use Application\Entity\Db\Corps;
use Application\Entity\Db\Correspondance;
use Application\Entity\Db\Grade;
use Application\Provider\Privilege\CorpsPrivileges;

$this->headTitle('Corps, grades et correspondances');

$canAfficher = $this->isAllowed(CorpsPrivileges::getResourceId(CorpsPrivileges::CORPS_AFFICHER));
$canModifier = $this->isAllowed(CorpsPrivileges::getResourceId(CorpsPrivileges::CORPS_MODIFIER));
?>

<div class="row">
    <div class="col-md-8">
        <h1 class="page-header">
            Catégories, corps, grades et correspondances
        </h1>
    </div>
</div>

<div role="tabpanel">
    <ul class="nav nav-tabs" role="tablist">

        <li>
            <a href="#categorie" aria-controls="categorie" role="tab" data-toggle="tabz">
                Catégories
                <span class="badge">
                    <?php echo count($categories); ?>
                </span>
                <span style="color:white;"><?php echo $this->synchroniserIcon(false); ?></span>
            </a>
        </li>

        <li>
            <a href="#corps" aria-controls="corps" role="tab" data-toggle="tabz">
                Corps
                <span class="badge">
                    <?php echo count($corps); ?>
                </span>
                <?php echo $this->synchroniserIcon(); ?>
            </a>
        </li>

        <li>
            <a href="#grade" aria-controls="grade" role="tab" data-toggle="tabz">
                Grades &nbsp;
                <span class="badge">
                    <?php echo count($grades); ?>
                </span>
                <?php echo $this->synchroniserIcon(); ?>
            </a>
        </li>

        <li>
            <a href="#correspondance" aria-controls="correspondance" role="tab" data-toggle="tabz" >
                Correspondances &nbsp;
                <span class="badge">
                    <?php echo count($correspondances); ?>
                </span>
                <?php echo $this->synchroniserIcon(); ?>
            </a>
        </li>
    </ul>

    <div class="main-with-tab">

        <div class="tab-content">

            <!-- CATEGORIES ------------------------------------------------------------------------------------------->
            <div id="categorie" class="tab-pane " role="tabpanel">
                <?php echo $this->partial('partial/index-categorie', ['categories' => $categories]); ?>
            </div>

            <!-- CORPS ------------------------------------------------------------------------------------------------>
            <div id="corps" class="tab-pane " role="tabpanel">
                <?php echo $this->partial('partial/index-corps', ['corps' => $corps, 'canAfficher' => $canAfficher, 'canModifier' => $canModifier]); ?>
            </div>

            <!-- GRADES ----------------------------------------------------------------------------------------------->
            <div id="grade" class="tab-pane " role="tabpanel">
                <?php echo $this->partial('partial/index-grade', ['grades' => $grades, 'canAfficher' => $canAfficher, 'canModifier' => $canModifier]); ?>
            </div>

            <!-- CORRESPONDANCES -------------------------------------------------------------------------------------->
            <div id="correspondance" class="tab-pane " role="tabpanel">
                <?php echo $this->partial('partial/index-correspondance', ['correspondances' => $correspondances, 'canAfficher' => $canAfficher, 'canModifier' => $canModifier]); ?>
            </div>

        </div>
    </div>
</div>




</div>


<script>
    $(document).ready(function() {
        $('.datatable').DataTable( {
            language: {
                url: '/localisation/fr_FR.json'
            },
            "pageLength": 10,
            "lengthMenu": [ [10, 25, 50, -1], [10, 25, 50, "All"] ],
        } );
    } );

    $(function() {
        let hash = $(location).attr('hash');
        let name = hash.substr(1);
        if (name === undefined || name === "") name = "corps";

        $('a[aria-controls=' + name + ']').tab('show');

        $('.nav-tabs a').click(function (e) {
            // No e.preventDefault() here
            $(this).tab('show');
        });

        $("body").on("modification", function (event) {
            event.div.modal('hide');
            window.location.reload();
        });
    });
</script>
