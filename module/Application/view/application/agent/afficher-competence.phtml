<?php

/**
 * @see AgentController::afficherCompetenceAction()
 * @var CompetenceElement $competenceElement
 * @var Agent $agent
 */

use Application\Entity\Db\Agent;
use Application\Entity\Db\CompetenceElement;

$type = null;
$annee = null;
if ($competenceElement->getCommentaire() !== null) {
    $split = explode(" - ", $competenceElement->getCommentaire());
    $niveau = $split[1];
    $annee = $split[0];
}
?>

<div class="row">
    <div class="col-md-6">
        <dl>
            <dt> Agent </dt>
            <dd> <?php echo $agent->getDenomination(); ?></dd>
            <dt> Application </dt>
            <dd> <?php echo $competenceElement->getCompetence()->getLibelle(); ?></dd>
            <dt> Niveau de formation </dt>
            <dd> <?php echo ($niveau)?:"Non renseigné"; ?></dd>
            <dt> Année de formation </dt>
            <dd> <?php echo ($annee)?:"Non renseignée"; ?></dd>
            <dt> Validation </dt>
            <dd>
                <?php if ($competenceElement->getValidation() === null) : ?>
                    Aucune validation
                <?php else: ?>
                    <?php $validation = $competenceElement->getValidation(); ?>
                    <?php if ($validation->getValeur() === null) : ?>
                        <span
                            style="color:darkgreen;"
                            title=" Par <?php echo $validation->getHistoModificateur()->getDisplayName(); ?> le <?php echo $validation->getHistoModification()->format("d/m/Y"); ?>">
                                    <span class="icon ok"></span>
                                    Validée
                                </span>
                    <?php else: ?>
                    <span
                        style="color:darkred;"
                        title=" Par <?php echo $validation->getHistoModificateur()->getDisplayName(); ?> le <?php echo $validation->getHistoModification()->format("d/m/Y"); ?>">
                                    <span class="icon ko"></span>
                                Refusée
                    <?php endif; ?>
                <?php endif; ?>
            </dd>
        </dl>
    </div>
    <div class="col-md-6">
        <dl>
            <dt> Dernière modification </dt>
            <dd>
                <?php echo $competenceElement->getHistoModification()->format('d/m/Y à H:i:s'); ?>
                <br/>
                <?php echo $competenceElement->getHistoModificateur()->getDisplayName(); ?>
            </dd>
        </dl>

        <?php if ($competenceElement->estHistorise()) : ?>
            <dl>
                <dt> Historisée </dt>
                <dd>
                    <?php echo $competenceElement->getHistoDestruction()->format('d/m/Y à H:i:s'); ?>
                    <br/>
                    <?php echo $competenceElement->getHistoDestructeur()->getDisplayName(); ?>
                </dd>
            </dl>
        <?php endif; ?>
    </div>
</div>
