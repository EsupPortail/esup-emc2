<?php

/**
 * @var FicheTypeExterne $fiche
 * @var array $options
 */

use Application\Entity\Db\FicheTypeExterne;

?>

<div class="panel panel-info">
    <div class="panel-heading">
        <div class="row">
            <div class="col-md-8">
                <h2> <?php echo $fiche->getFicheType()->getMetier()->getLibelle(); ?> </h2>
                <?php $metier =  $fiche->getFicheType()->getMetier(); ?>
                <?php if ($metier) : ?>
                    <?php foreach($metier->getReferences() as $reference) : ?>
                        <span class="badge" style="background-color: #dfc4b2"><a href="<?php echo $reference->getUrl(); ?>"> <?php echo $reference->getTitre(); ?> </a></span>
                    <?php endforeach; ?>
                <?php endif; ?>
            </div>
            <div class="col-md-1 pull-right">
                <?php if (isset($options['mode']) AND $options['mode'] === 'edition-fiche-poste') : ?>
                    <a
                        <?php /** @see \Application\Controller\FichePosteController::modifierFicheMetierAction() */ ?>
                        href="<?php echo $this->url('fiche-poste/modifier-fiche-metier', ['fiche-poste' => $fiche->getFichePoste()->getId(), 'fiche-type-externe' => $fiche->getId()], [], true); ?>"
                        class="ajax-modal" data-event="modification"
                    >
                       <span class="icon editer" title="Modifier la fiche métier"></span></a>
                    <a
                        <?php /** @see \Application\Controller\FichePosteController::selectionnerActiviteAction() */ ?>
                        href="<?php echo $this->url('fiche-poste/selectionner-activite', ['fiche-poste' => $fiche->getFichePoste()->getId(), 'fiche-type-externe' => $fiche->getId()], [], true); ?>"
                        class="ajax-modal" data-event="modification"
                    >
                       <span class="icon listing" title="Sélectionner les activités associées"></span></a>
                    <a
                        <?php /** @see \Application\Controller\FichePosteController::retirerFicheMetierAction() */ ?>
                        href="<?php echo $this->url('fiche-poste/retirer-fiche-metier', ['fiche-poste' => $fiche->getFichePoste()->getId(), 'fiche-type-externe' => $fiche->getId()], [], true); ?>"
                    >
                        <span class="icon detruire" title="Retirer la fiche métier"></span></a>
                <?php endif; ?>
            </div>
            <div class="col-md-2 pull-right">
                <?php if ($fiche->getPrincipale()) : ?>
                    Principale <br/>
                <?php endif ;?>
                <?php echo $fiche->getQuotite(); ?> %
            </div>
        </div>
    </div>
    <div class="panel-body">
        <?php
            $options['sans-titre'] = true;
            $options['activite-liste'] = $fiche->getActivites();
            echo $this->ficheMetier($fiche->getFicheType(), $fiche->getFichePoste(), $options);
        ?>
    </div>
</div>