<?php

use Application\Controller\ActiviteController;
use Application\Controller\FicheMetierController;
use Application\Entity\Db\Activite;
use Application\Entity\Db\FicheMetierTypeActivite;

/**
 * @var Activite|FicheMetierTypeActivite $activite
 * @var array $options
 */

$type = null;
if ($activite instanceof FicheMetierTypeActivite) {
    $type = $activite;
    $activite  = $activite->getActivite();
}

$editMode = false;
if (isset($options['edit-mode'])) $editMode = ($options['edit-mode'] === true);



$competences   = $activite->getCompetences();
$nbCompetence  = count($competences);
$applications  = $activite->getApplications();
$nbApplication = count($applications);
$formations    = $activite->getFormations();
$nbFormation   = count($formations);

$nbObject      = $nbCompetence + $nbFormation + $nbApplication;
?>

<div class="panel panel-info">
    <div class="panel-heading">
        <h2>
            <?php echo $activite->getLibelle(); ?>
        </h2>
    </div>
    <div class="panel-body">
        <?php if ($editMode === true && $type !== null) : ?>
        <div class="col-md-1" style="border:1px lightgray solid; padding: 5px; text-align: center;">
            <?php /** @see ActiviteController::editerAction() */ ?>
            <a href="<?php echo $this->url('activite/editer', ['activite' => $activite->getId()], [], true); ?>"
               class="btn btn-default ajax-modal"
               data-event="modification"
               style="width:5rem; margin: 5px;"
            >
                <span class="icon editer"></span><br/>
            </a>
            <?php /** @see FicheMetierController::retirerActiviteAction() */ ?>
            <a href="<?php echo $this->url('fiche-metier-type/retirer-activite', ['id' => $type->getId()], [], true); ?>"
               class="btn btn-default"
               style="width:5rem; margin: 5px;">
                <span class="icon detruire"></span><br/>
            </a>
            <?php /** @see FicheMetierController::deplacerActiviteAction() */ ?>
            <a href="<?php echo $this->url('fiche-metier-type/deplacer-activite', ['id' => $type->getId(), 'direction' => 'up'], [], true); ?>"
               class="btn btn-default"
               style="width:5rem; margin: 5px;">
                <span class="icon monter"></span><br/>
            </a>
            <?php /** @see FicheMetierController::deplacerActiviteAction() */ ?>
            <a href="<?php echo $this->url('fiche-metier-type/deplacer-activite', ['id' => $type->getId(), 'direction' => 'down'], [], true); ?>"
               class="btn btn-default"
               style="width:5rem; margin: 5px;">
                <span class="icon descendre"></span><br/>
            </a>
        </div>
        <div class="col-md-7">
            <h4> Description </h4>
            <?php echo $activite->getDescription(); ?>
        </div>
        <?php else : ?>
            <div class="col-md-8">
                <h4> Description </h4>
                <?php echo $activite->getDescription(); ?>
            </div>
        <?php endif; ?>

        <?php if ($nbObject !== 0) : ?>
            <div class="col-md-4" style="border:1px lightblue solid">
                <small>
                <?php if ($nbCompetence > 0) : ?>
                    <h4>
                        <span class="icon competence"></span>
                        Comp√©tences
                        <span class="badge"> <?php echo $nbCompetence; ?></span>
                    </h4>

                    <ul>
                        <?php foreach ($competences as $competence) : ?>
                        <li>
                            <?php echo $competence->getLibelle(); ?>
                        </li>
                        <?php endforeach; ?>
                    </ul>
                <?php endif; ?>

                <?php if ($nbApplication > 0) : ?>
                    <h4>
                        <span class="icon application"></span>
                        Applications
                        <span class="badge"> <?php echo $nbApplication; ?></span>
                    </h4>

                    <ul>
                        <?php foreach ($applications as $application) : ?>
                            <li>
                                <?php echo $application->getLibelle(); ?>
                            </li>
                        <?php endforeach; ?>
                    </ul>
                <?php endif; ?>

                <?php if ($nbFormation > 0) : ?>
                    <h4>
                        <span class="icon formation"></span>
                        Formations
                        <span class="badge"> <?php echo $nbFormation; ?></span>
                    </h4>

                    <ul>
                        <?php foreach ($formations as $formation) : ?>
                            <li>
                                <?php echo $formation->getLibelle(); ?>
                            </li>
                        <?php endforeach; ?>
                    </ul>
                <?php endif; ?>
                </small>
            </div>
        <?php endif; ?>
    </div>
</div>

<style>
    a.btn-default {
        background-color: lightgrey;
    }
    a.btn-default:hover {
        background-color: #aaaaaa;
    }
</style>