<?php

/**
 * @var Agent $agent
 */

use Application\Entity\Db\Agent;
use Application\Entity\Db\AgentGrade;
use Application\Entity\Db\AgentMissionSpecifique;
use Application\Entity\Db\AgentStatut;

$now = new DateTime();
?>

<div class="alert alert-warning">
    <strong><span class="icon information"></span> Informations affichés :</strong>
    <ul>
        <li> Seuls les statuts et les grades actifs sont affichés par choix voir avec le groupe GPEEC pour ce que l'on affiche. </li>
    </ul>
</div>

<h3> Présentation de l'agent </h3>

<?php
?>

<dl class="dl-horizontal">
    <dt> Prénom </dt>
    <dd> <?php echo $agent->getPrenom(); ?> </dd>
    <dt> Nom </dt>
    <dd> <?php echo $agent->getNomUsuel(); ?> </dd>
    <dt> Quotité travaillée </dt>
    <dd> <?php echo $agent->getQuotite(); ?> </dd>
</dl>

<h3>Statuts actifs </h3>

<?php
    $statuts = $agent->getStatuts();
    usort($statuts, function (AgentStatut $a, AgentStatut $b) { return $a->getDebut() < $b->getDebut();});
?>

<?php foreach ($statuts as $statut) : ?>
    <?php if ($statut->getFin() === null or $statut->getFin() > $now) : ?>
        <?php echo $this->agentStatut($statut, ['denomination' => false]); ?>
    <?php endif; ?>
<?php endforeach; ?>

<h3>Grade </h3>

<?php
$grades = $agent->getGrades();
usort($grades, function (AgentGrade $a, AgentGrade $b) { return $a->getDateDebut() < $b->getDateDebut();});
?>

<?php foreach ($grades as $grade) : ?>
    <?php if ($grade->getDateFin() === null or $grade->getDateFin() > $now) : ?>
        <?php echo $this->agentGrade($grade, ['id' => false, 'denomination' => false]); ?>
    <?php endif; ?>
<?php endforeach; ?>
<!--<ul>-->
<!--    --><?php //foreach ($grades as $grade) : ?>
<!--    <li>-->
<!--        --><?php //echo ($grade->getStructure())?$grade->getStructure()->getLibelleLong():""; ?>
<!--        --><?php //echo ($grade->getGrade())?$grade->getGrade()->getLibelleLong():""; ?>
<!--        --><?php //echo ($grade->getCorps())?$grade->getCorps()->getLibelleLong():""; ?>
<!--        --><?php //echo ($grade->getBap())?$grade->getBap()->getLibelleLong():""; ?>
<!--    </li>-->
<!--    --><?php //endforeach; ?>
<!--</ul>-->



<h3> Missions spécifiques </h3>

<ul>
    <?php /** @var AgentMissionSpecifique $mission */ ?>
    <?php foreach ($agent->getMissionsSpecifiques() as $mission) : ?>
        <li>
            <?php echo $mission->getMission()->getLibelle(); ?>
            <?php if ($mission->getStructure()) echo  " pour ".$mission->getStructure()->getLibelleCourt(); ?>
             du
            <?php echo ($mission->getDateDebut()?$mission->getDateDebut()->format('d/m/Y'):"---"); ?>
            au
            <?php echo ($mission->getDateFin()?$mission->getDateFin()->format('d/m/Y'):"---"); ?>
        </li>
    <?php endforeach; ?>
</ul>
