<?php

use Application\Entity\Db\Competence;
use Application\Entity\Db\CompetenceType;

/**
 * @var array $competences
 * @var CompetenceType[] $types (n.b. deja ordonnÃ©e)
 * @var array $options
 *
 * la sutrcture de application est la suivante :
 *
 * $applications = [
 *      ID => [
 *          'entite' => Application,
 *          'display' => true|false,
 *          'raison' => [
 *                  [ 'source', SourceEntity ],
 *                  [ 'source', SourceEntity ],
 *                  ...
 *              ]
 *          ],
 *      ...
 *  ]
 */

$groupes = [];
$sansGroupe = "zzz";
foreach ($competences as $item) {
    /** @var Competence $competence */
    $competence = $item['entite'];
    if ($competence) {
        $libelleGroupe = ($competence->getType()) ? $competence->getType()->getLibelle() : $sansGroupe;
        if ($item['conserve'] === true) $groupes[$libelleGroupe][] = $item;
    }
}

ksort($groupes);

?>

<ul>
<?php foreach ($types as $type) : ?>
    <?php $groupe = $groupes[$type->getLibelle()]; ?>
    <?php if ($groupe !== null AND !empty($groupe)) : ?>
        <?php usort($groupe, function ($a, $b) { return $a['entite']->getLibelle() > $b['entite']->getLibelle(); }); ?>
        <li class="groupe-libelle">
            <?php echo $type->getLibelle(); ?>
        </li>
        <ul>
            <?php foreach ($groupe as $competence) : ?>
                <li class="element-libelle">
                    <?php echo $competence['entite']->getLibelle(); ?>
                    <?php echo $this->raisons($competence['raison']); ?>
                </li>
            <?php endforeach; ?>
        </ul>
    <?php endif; ?>
<?php endforeach; ?>
</ul>


