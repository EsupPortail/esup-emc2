<?php

/**
 * @var FormationInstance[] $instances
 * @var FormationInstanceInscrit[] $inscriptions
 * @var Agent $agent
 */

use Application\Entity\Db\Agent;
use Formation\Entity\Db\FormationInstance;
use Formation\Entity\Db\FormationInstanceInscrit;

$canInscrire = true;

?>
<h2>
    Mes inscriptions
    <span class="badge"><?php echo count($inscriptions); ?></span>
</h2>

<?php foreach ($inscriptions as $inscription) : ?>
    <?php
        $instance = $inscription->getInstance();
        $nbPlace = ($instance->getNbPlacePrincipale() + $instance->getNbPlaceComplementaire()) - (count($instance->getListePrincipale()) + count($instance->getListeComplementaire()));
    ?>
    <div class="row formation-inscription">
        <div class="col-md-8 description">
            <?php echo $this->formationInstanceInformations($instance, 'bloc'); ?>
            <br/>
            <?php if ($inscription->getListe() !==null) : ?>
                <strong> Inscrit en liste <?php echo $inscription->getListe(); ?></strong>
            <?php else : ?>
                Demande d'inscription enregristrer
            <?php endif; ?>
        </div>
        <div class="pull-right">
            <a
                <?php /** @see \Formation\Controller\FormationInstanceInscritController::desinscriptionAction() */?>
                    href="<?php echo $this->url('formation-instance/desinscription', ['inscrit' => $inscription->getId()], [], true); ?>"
                    class="btn btn-danger action ajax-modal" data-event="modification"
            >
                <span class="icon icon-retirer"> J'annule mon inscription </span>
            </a>
            <?php if ($instance->getEtat()->getCode() === FormationInstance::ETAT_FORMATION_CONVOCATION AND $inscription->getListe() === FormationInstanceInscrit::PRINCIPALE) : ?>
            <br/>
                <a
                    <?php /** @see \Formation\Controller\FormationInstanceDocumentController::genererConvocationAction() */?>
                        href="<?php echo $this->url('formation-instance/generer-convocation', ['inscrit' => $inscription->getId()], [], true); ?>" class="btn btn-primary action"
                >
                    <span class="icon icon-pdf"> Je télécharge ma convocation</span>
                </a>
            <?php endif; ?>
        </div>
    </div>
    <br/>
<?php endforeach; ?>