<?php

/**
 * @see \UnicaenValidation\Controller\ValidationTypeController::indexAction()
 * @var ValidationType[] $types;
 */

use UnicaenValidation\Entity\Db\ValidationType;
use UnicaenValidation\Provider\Privilege\ValidationtypePrivileges;

$this->headTitle("Index des types de validation");

$canAfficher = $this->isAllowed(ValidationtypePrivileges::getResourceId(ValidationtypePrivileges::VALIDATIONTYPE_AFFICHER));
$canAjouter = $this->isAllowed(ValidationtypePrivileges::getResourceId(ValidationtypePrivileges::VALIDATIONTYPE_MODIFIER));
$canModifier = $this->isAllowed(ValidationtypePrivileges::getResourceId(ValidationtypePrivileges::VALIDATIONTYPE_MODIFIER));
$canHistoriser = $this->isAllowed(ValidationtypePrivileges::getResourceId(ValidationtypePrivileges::VALIDATIONTYPE_HISTORISER));
$canDetruire = $this->isAllowed(ValidationtypePrivileges::getResourceId(ValidationtypePrivileges::VALIDATIONTYPE_DETRUIRE));
?>

<h1 class="page-header">
    Index des types de validations
</h1>

<div class="main">

    <?php if ($canAjouter): ?>
        <a
            <?php /** @see \UnicaenValidation\Controller\ValidationTypeController::ajouterAction() */ ?>
            href="<?php echo $this->url('validation/type/ajouter', [], [], true); ?>"
            class="btn btn-primary action ajax-modal"
            data-event="modification"
        >
            <span class="icon ajouter"> Ajouter un type de validation</span>
        </a>
    <?php endif; ?>

    <table class="table table-condensed">
        <thead>
            <tr>
                <th> Code </th>
                <th> Libelle </th>
                <th> Est refusable </th>
                <th> Action </th>
            </tr>
        </thead>
        <tbody>
            <?php /** @var ValidationType $type */ ?>
            <?php foreach ($types as $type) : ?>
                <tr>
                    <td> <?php echo $type->getCode(); ?> </td>
                    <td> <?php echo $type->getLibelle(); ?> </td>
                    <td>
                        <?php if ($type->isRefusable()) : ?>
                            <span class="icon ok" style="color:darkgreen;"></span>
                        <?php else : ?>
                            <span class="icon ko" style="color:darkred;"></span>
                        <?php endif; ?>
                    </td>
                    <td>
                        <?php if ($canModifier): ?>
                            <a
                                <?php /** @see \UnicaenValidation\Controller\ValidationTypeController::modifierAction() */?>
                                href="<?php echo $this->url('validation/type/modifier', ['type' => $type->getId()], [], true); ?>"
                                class="ajax-modal" data-event="modification"
                            >
                                <span class="icon editer" title="Modifier le type de validation"></a>
                        <?php endif; ?>

                        <?php if ($canHistoriser): ?>
                            <?php if ($type->estNonHistorise()) :?>
                                <a
                                    <?php /** @see \UnicaenValidation\Controller\ValidationTypeController::modifierAction() */?>
                                    href="<?php echo $this->url('validation/type/historiser', ['type' => $type->getId()], [], true); ?>"
                                >
                                    <span class="icon historiser" title="Historiser le type de validation"></a>
                            <?php else : ?>

                                <a
                                    <?php /** @see \UnicaenValidation\Controller\ValidationTypeController::modifierAction() */?>
                                    href="<?php echo $this->url('validation/type/restaurer', ['type' => $type->getId()], [], true); ?>"
                                >
                                    <span class="icon restaurer" title="Restaurer le type de validation"></a>
                            <?php endif; ?>
                        <?php endif; ?>

                        <?php if ($canDetruire): ?>
                            <a
                                <?php /** @see \UnicaenValidation\Controller\ValidationTypeController::detruireAction() */?>
                                href="<?php echo $this->url('validation/type/detruire', ['type' => $type->getId()], [], true); ?>"
                                class="ajax-modal" data-event="modification"
                            >
                                <span class="icon detruire" title="Supprimer dÃ©finitivement le type de validation"></a>
                        <?php endif; ?>
                    </td>
                </tr>
            <?php endforeach; ?>
        </tbody>
    </table>
</div>

<script>
    $(function() {
        $("body").on("modification", function (event) {
            event.div.modal('hide');
            window.location.reload();
        });
    });
</script>