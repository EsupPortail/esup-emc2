<?php

use Application\Provider\Privilege\FicheMetierPrivileges;
use FicheMetier\Entity\Db\FicheMetier;
use FicheMetier\Provider\Parametre\FicheMetierParametres;
use UnicaenParametre\Entity\Db\Parametre;

/**
 * @var FicheMetier $fichemetier
 * @var string $mode
 * @var Parametre[] $parametres
 */

$canEditer = $this->isAllowed(FicheMetierPrivileges::getResourceId(FicheMetierPrivileges::FICHEMETIER_MODIFIER));


?>

<dl class="row">
    <?php if (!isset($parametres[FicheMetierParametres::CODE_FONCTION]) || $parametres[FicheMetierParametres::CODE_FONCTION]->getValeur() !== "false") : ?>
        <dt class="col-md-4"> Niveau de fonction</dt>
        <dd class="col-md-8">
            <?php if ($fichemetier->getCodeFonction()): ?>
                <?php echo $fichemetier->getCodeFonction()->getNiveauFonction()?->getLibelle(); ?>
            <?php else : ?>
                <span class="missing-data">Aucun niveau associé</span>
            <?php endif; ?>
        </dd>
    <?php endif; ?>
    <?php $famille = $fichemetier->getFamilleProfessionnelle(); ?>
    <dt class="col-md-4"> Spécialité</dt>
    <dd class="col-md-8">
        <?php if ($famille === null) : ?>
            <em>Aucune spécialité</em> <span class="icon icon-info"
                                             title="L'absence de famille empêche de déterminer la spécialité"></span>
        <?php elseif ($famille->getCorrespondance() === null) : ?>
            <em style="color:gray;">Aucune spécialité </em><span class="icon icon-info"
                                                                 title="Aucune spécialité liée à la famille professionnelle"></span>
        <?php else : ?>
            <?php echo $famille->getCorrespondance()->getLibelleLong(); ?>
        <?php endif; ?>
    </dd>
    <dt class="col-md-4"> Famille professionnelle</dt>
    <dd class="col-md-8">
        <?php if ($famille === null) : ?>
            <em>Aucune famille professionnelle </em>
        <?php else : ?>
            <?php echo $famille->getLibelle(); ?>
        <?php endif; ?>
    </dd>
    <dt class="col-md-4"> Catégorie  </dt>
    <dd class="col-md-8">
        <?php if ($fichemetier->getCategorie() === null) : ?>
            <span class="missing-data">Aucune catégorie associé</span>
        <?php else : ?>
            <?php echo $fichemetier->getCategorie()->getLibelle(); ?>
        <?php endif; ?>
        <br> <!-- // todo : retirer ce br copium -->
        <?php if ($mode === 'edition-fiche-metier' AND $canEditer) : ?>
            <?php /** @see FicheMetierController::modifierCategorieAction() */ ?>
            <a href="<?php echo $this->url('fiche-metier/modifier-categorie', ['fiche-metier' => $fichemetier->getId()], [], true); ?>"
               class="ajax-modal action primary" data-event="modification"
            >
                <small>
                    <span class="icon icon-editer"></span>
                    Modifier
                </small>
            </a>
            <?php /** @see FicheMetierController::supprimerCategorieAction() */ ?>
            <a href="<?php echo $this->url('fiche-metier/supprimer-categorie', ['fiche-metier' => $fichemetier->getId()], [], true); ?>"
               class="action danger"
            >
                <small>
                    <span class="icon icon-unchecked"></span>
                    Supprimer
                </small>
            </a>
        <?php endif; ?>
    </dd>
    <dt class="col-md-4"> Niveau de carrière </dt>
    <dd class="col-md-8">
        <?php if ($fichemetier->getNiveauCarriere() === null) : ?>
            <span class="missing-data">Aucun niveau associé</span>
        <?php else : ?>
            <?php echo $fichemetier->getNiveauCarriere()->getLibelle(); ?>
<!--            --><?php //if ($fichemetier->getNiveauCarriere()->getCategorie()): ?>
<!--                (--><?php //echo $fichemetier->getNiveauCarriere()->getCategorie()->getLibelle(); ?><!--)-->
<!--            --><?php //endif; ?>
        <?php endif; ?>
        <br> <!-- // todo : retirer ce br copium -->
        <?php if ($mode === 'edition-fiche-metier' AND $canEditer) : ?>
            <?php /** @see FicheMetierController::modifierNiveauCarriereAction() */ ?>
            <a href="<?php echo $this->url('fiche-metier/modifier-niveau-carriere', ['fiche-metier' => $fichemetier->getId()], [], true); ?>"
               class="ajax-modal action primary" data-event="modification"
            >
                <small>
                    <span class="icon icon-editer"></span>
                    Modifier
                </small>
            </a>
            <?php /** @see FicheMetierController::supprimerNiveauCarriereAction() */ ?>
            <a href="<?php echo $this->url('fiche-metier/supprimer-niveau-carriere', ['fiche-metier' => $fichemetier->getId()], [], true); ?>"
               class="action danger"
            >
                <small>
                    <span class="icon icon-unchecked"></span>
                    Supprimer
                </small>
            </a>
        <?php endif; ?>
    </dd>
    <?php if (!isset($parametres[FicheMetierParametres::CODE_FONCTION]) || $parametres[FicheMetierParametres::CODE_FONCTION]->getValeur() !== "false") : ?>
        <dt class="col-md-4"> Code Fonction</dt>
        <dd class="col-md-8">
            <?php $code = $fichemetier->getCodeFonction(); ?>
            <?php if ($code !== null) : ?>
                <code> <?php echo $code->computeCode(); ?> </code>
            <?php else : ?>
                <em style="color:gray;">Non renseigné</em>
            <?php endif; ?>
            <br> <!-- // todo : retirer ce br copium -->
            <?php if ($mode === 'edition-fiche-metier' and $canEditer) : ?>
                <?php /** @see FicheMetierController::modifierCodeFonctionAction() */ ?>
                <a href="<?php echo $this->url('fiche-metier/modifier-code-fonction', ['fiche-metier' => $fichemetier->getId()], [], true); ?>"
                   class="ajax-modal action primary" data-event="modification"
                >
                    <small>
                        <span class="icon icon-editer"></span>
                        Modifier
                    </small>
                </a>
                <?php /** @see FicheMetierController::supprimerCodeFonctionAction() */ ?>
                <a href="<?php echo $this->url('fiche-metier/supprimer-code-fonction', ['fiche-metier' => $fichemetier->getId()], [], true); ?>"
                   class="action danger"
                >
                    <small>
                        <span class="icon icon-unchecked"></span>
                        Supprimer
                    </small>
                </a>
            <?php endif; ?>
        </dd>
        <dt class="col-md-4"> Codes Emploi Type</dt>
        <dd class="col-md-8">
            <?php $codeET = $fichemetier->getCodesEmploiType() ?>
            <?php if ($codeET !== null) : ?>
                <code> <?php echo $codeET; ?> </code>
            <?php else : ?>
                <em style="color:gray;">Non renseigné</em>
            <?php endif; ?>
            <br> <!-- // todo : retirer ce br copium -->
            <?php if ($mode === 'edition-fiche-metier' and $canEditer) : ?>
                <?php /** @see FicheMetierController::modifierCodeEmploiTypeAction() */ ?>
                <a href="<?php echo $this->url('fiche-metier/modifier-code-emploi-type', ['fiche-metier' => $fichemetier->getId()], [], true); ?>"
                   class="ajax-modal action primary" data-event="modification"
                >
                    <small>
                        <span class="icon icon-editer"></span>
                        Modifier
                    </small>
                </a>
                <?php /** @see FicheMetierController::supprimerCodeFonctionAction() */ ?>
                <a href="<?php echo $this->url('fiche-metier/supprimer-code-emploi-type', ['fiche-metier' => $fichemetier->getId()], [], true); ?>"
                   class="action danger"
                >
                    <small>
                        <span class="icon icon-unchecked"></span>
                        Supprimer
                    </small>
                </a>
            <?php endif; ?>
        </dd>
    <?php endif; ?>
    <dt class="col-md-4"> Niveau de carrière</dt>
    <dd class="col-md-8">
        <?php if ($fichemetier->getNiveauCarriere() === null) : ?>
            <span class="missing-data">Aucun niveau associé</span>
        <?php else : ?>
            <?php echo $fichemetier->getNiveauCarriere()->getLibelle(); ?>
            <!--            --><?php //if ($fichemetier->getNiveauCarriere()->getCategorie()): ?>
            <!--                (--><?php //echo $fichemetier->getNiveauCarriere()->getCategorie()->getLibelle(); ?><!--)-->
            <!--            --><?php //endif; ?>
        <?php endif; ?>
        <br> <!-- // todo : retirer ce br copium -->
        <?php if ($mode === 'edition-fiche-metier' and $canEditer) : ?>
            <?php /** @see FicheMetierController::modifierNiveauCarriereAction() */ ?>
            <a href="<?php echo $this->url('fiche-metier/modifier-niveau-carriere', ['fiche-metier' => $fichemetier->getId()], [], true); ?>"
               class="ajax-modal action primary" data-event="modification"
            >
                <small>
                    <span class="icon icon-editer"></span>
                    Modifier
                </small>
            </a>
            <?php /** @see FicheMetierController::supprimerNiveauCarriereAction() */ ?>
            <a href="<?php echo $this->url('fiche-metier/supprimer-niveau-carriere', ['fiche-metier' => $fichemetier->getId()], [], true); ?>"
               class="action danger"
            >
                <small>
                    <span class="icon icon-unchecked"></span>
                    Supprimer
                </small>
            </a>
        <?php endif; ?>
    </dd>
    <dt class="col-md-4"> Date de dépôt</dt>
    <dd class="col-md-8"> <?php echo $fichemetier->getEtatActif()?->getHistoCreation()->format("d/m/Y"); ?></dd>
    <dt class="col-md-4"> État</dt>
    <dd class="col-md-8">
        <?php echo $this->etatinstance($fichemetier->getEtatActif()); ?>
    </dd>
</dl>
