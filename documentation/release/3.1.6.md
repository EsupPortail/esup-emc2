```sql
create table missionprincipale
(
    id                    serial                  not null
        constraint missionprincipale_pk
            primary key,
    libelle               varchar(1024),
    niveau_id             integer
        constraint missionprincipale_carriere_niveau_enveloppe_id_fk
            references carriere_niveau_enveloppe
            on delete cascade,
    histo_creation        timestamp default now() not null,
    histo_createur_id     integer   default 0     not null
        constraint missionprincipale_unicaen_utilisateur_user_id_fk3
            references unicaen_utilisateur_user,
    histo_modification    timestamp,
    histo_modificateur_id integer
        constraint missionprincipale_unicaen_utilisateur_user_id_fk
            references unicaen_utilisateur_user,
    histo_destruction     timestamp,
    histo_destructeur_id  integer
        constraint missionprincipale_unicaen_utilisateur_user_id_fk2
            references unicaen_utilisateur_user
);


insert into missionprincipale (id, libelle, niveau_id)
select a.id, al.libelle, a.niveaux_id
from activite a
         join activite_libelle al on a.id = al.activite_id
where a.histo_destruction IS NULL AND al.
    histo_destruction IS NULL;

drop table activite_libelle;

select max(id) from missionprincipale;
alter sequence missionprincipale_id_seq restart with 14; -- TODO changer avec valeur ci-dessus

alter table activite_domaine rename to missionprincipale_domaine;
alter table missionprincipale_domaine rename column activite_id to mission_id;
alter table activite_description rename to missionprincipale_activite;
alter table missionprincipale_activite rename column activite_id to mission_id;
alter table activite_application rename to missionprincipale_application;
alter table missionprincipale_application rename column activite_id to mission_id;
alter table activite_competence rename to missionprincipale_competence;
alter table missionprincipale_competence rename column activite_id to mission_id;
drop table activite_formation;
alter table fichemetier_activite rename column activite_id to mission_id;
alter table fichemetier_activite drop constraint fichemetier_activite_activite_id_fk;
alter table fichemetier_activite add constraint fichemetier_activite_missionprincipale_id_fk foreign key (mission_id) references missionprincipale on delete cascade;
alter table fichemetier_activite rename to fichemetier_mission;

alter table fichemetier_mission rename column position to ordre;
alter table fichemetier_mission rename column fiche_id to fichemetier_id;


INSERT INTO unicaen_privilege_categorie (code, libelle, ordre, namespace)
VALUES ('missionprincipale', 'Gestion des missions principales', 800, 'FicheMetier\Provider\Privilege');
INSERT INTO unicaen_privilege_privilege(CATEGORIE_ID, CODE, LIBELLE, ORDRE)
WITH d(code, lib, ordre) AS (
    SELECT 'missionprincipale_index', 'Accéder à l''index', 10 UNION
    SELECT 'missionprincipale_afficher', 'Afficher', 20 UNION
    SELECT 'missionprincipale_ajouter', 'Ajouter', 30 UNION
    SELECT 'missionprincipale_modifier', 'Modifier', 40 UNION
    SELECT 'missionprincipale_historiser', 'Historiser/Restaurer', 50 UNION
    SELECT 'missionprincipale_supprimer', 'Supprimer', 60 
)
SELECT cp.id, d.code, d.lib, d.ordre
FROM d
JOIN unicaen_privilege_categorie cp ON cp.CODE = 'missionprincipale';

```