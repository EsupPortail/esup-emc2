Version 4.3.4 (XX/01/2024)
====

Évolution
---
- Travail préparatoire pour UnicaenObservation
- Début de la mise en place des nouvelles observations

Modification en BD
---

```postgresql

-- --------------------------------------------------
-- Procédure de reprise est observation de l'ancien système
-- Appliquer celle-ci si vous avez réalisé une campagne d'entretien professionnel avant cette maj.    
-- --------------------------------------------------
-- Nota Bene : on reprend que les observations validées !!!

-- OBSERVATION SUR LES ENTRETIENS
-- Ajout de la colonne (pour stocker l'entretien concerné)
alter table unicaen_observation_observation_instance add entretien_id int;
alter table unicaen_validation_instance add observation_id int;
-- insert des nouvelles observations
insert into unicaen_observation_observation_instance
(type_id, observation, histo_creation, histo_createur_id, histo_modification, histo_modificateur_id, entretien_id)
select
    (select id from unicaen_observation_observation_type where code='OBS_EP_AGENT_ENTRETIEN') as type_id, observation_agent_entretien, histo_creation, histo_createur_id, histo_modification, histo_modificateur_id, entretien_id
from entretienprofessionnel_observation_old
where observation_agent_entretien IS NOT NULL AND histo_destruction IS NULL
;
-- Ajout dans le linker
insert into entretienprofessionnel_observation (entretien_id, observation_id)
select entretien_id, uooi.id as observation_id
from unicaen_observation_observation_instance uooi
         join unicaen_observation_observation_type uoot on uooi.type_id = uoot.id
where uoot.code='OBS_EP_AGENT_ENTRETIEN';
-- Ajout de la validation
insert into unicaen_validation_instance (type_id, refus, justification, histo_creation, histo_createur_id, observation_id)
select (select id from unicaen_validation_type where code='OBSERVATION_VALIDEE') as type_id, refus, justification, uvi.histo_creation, uvi.histo_createur_id, uooi.id as observation_id
from unicaen_validation_instance uvi
         join unicaen_validation_type uvt on uvi.type_id = uvt.id
         join entretienprofessionnel_validation epv on uvi.id = epv.validation_id
         join unicaen_observation_observation_instance uooi on uooi.entretien_id = epv.entretien_id
where uvt.code='ENTRETIEN_OBSERVATION';
insert into unicaen_observation_observation_validation (observation_instance_id, validation_id)
select unicaen_validation_instance.observation_id, id as validation_id from unicaen_validation_instance where observation_id IS NOT NULL;
-- retrait dans la colonne
alter table unicaen_observation_observation_instance drop entretien_id;
alter table unicaen_validation_instance drop observation_id;

-- OBSERVATION SUR LES PERSPECTIVES
alter table unicaen_observation_observation_instance add entretien_id int;
alter table unicaen_validation_instance add observation_id int;
-- insert des nouvelles observations
insert into unicaen_observation_observation_instance
(type_id, observation, histo_creation, histo_createur_id, histo_modification, histo_modificateur_id, entretien_id)
select
    (select id from unicaen_observation_observation_type where code='OBS_EP_AGENT_PERSPECTIVE') as type_id, observation_agent_perspective, histo_creation, histo_createur_id, histo_modification, histo_modificateur_id, entretien_id
from entretienprofessionnel_observation_old
where observation_agent_entretien IS NOT NULL AND histo_destruction IS NULL
;
-- Ajout dans le linker
insert into entretienprofessionnel_observation (entretien_id, observation_id)
select entretien_id, uooi.id as observation_id
from unicaen_observation_observation_instance uooi
         join unicaen_observation_observation_type uoot on uooi.type_id = uoot.id
where uoot.code='OBS_EP_AGENT_PERSPECTIVE';
-- Ajout de la validation
insert into unicaen_validation_instance (type_id, refus, justification, histo_creation, histo_createur_id, observation_id)
select (select id from unicaen_validation_type where code='OBSERVATION_VALIDEE') as type_id, refus, justification, uvi.histo_creation, uvi.histo_createur_id, uooi.id as observation_id
from unicaen_validation_instance uvi
         join unicaen_validation_type uvt on uvi.type_id = uvt.id
         join entretienprofessionnel_validation epv on uvi.id = epv.validation_id
         join unicaen_observation_observation_instance uooi on uooi.entretien_id = epv.entretien_id
where uvt.code='ENTRETIEN_OBSERVATION';
insert into unicaen_observation_observation_validation (observation_instance_id, validation_id)
select unicaen_validation_instance.observation_id, id as validation_id from unicaen_validation_instance where observation_id IS NOT NULL;
-- retrait dans la colonne
alter table unicaen_observation_observation_instance drop entretien_id;
alter table unicaen_validation_instance drop observation_id;
```

Evolution des librairies
---


```bash
```

ou

```bash
rm -fr vendor
rm -fr composer.lock
composer install
```

Evolution des macros et templates
---
